<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>SOA·IACORE · Dashboard V7</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="refresh" content="30">

<style>
:root{
  --bg:#08101F;--panel:#0E1A2F;--accent:#4EA2FF;
  --ok:#2ecc71;--warn:#f1c40f;--muted:#8aa4c8;
  --border:rgba(255,255,255,.08);
}
*{box-sizing:border-box;font-family:system-ui,-apple-system,Segoe UI,Roboto}
body{margin:0;background:var(--bg);color:#EAF0FF}

header{
  padding:20px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  background:#0B3D91;
}
header h1{margin:0;font-size:20px;letter-spacing:1px}
button{
  background:#102a52;color:#EAF0FF;
  border:1px solid var(--border);
  padding:8px 14px;border-radius:8px;cursor:pointer;
}

.grid{padding:30px;display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:24px}
.card{background:var(--panel);border:1px solid var(--border);border-radius:14px;padding:20px}
.metric{font-size:42px;font-weight:700;color:var(--ok)}
.label{font-size:14px;color:var(--muted)}

.bar{height:12px;background:#142540;border-radius:8px;overflow:hidden;margin-top:10px}
.bar span{display:block;height:100%;background:linear-gradient(90deg,var(--accent),var(--ok))}

.timeline .step{
  display:flex;justify-content:space-between;
  padding:6px 0;border-bottom:1px solid var(--border);
}
.done{color:var(--ok)} .wip{color:var(--warn)}

.hidden{display:none}

footer{
  text-align:center;font-size:13px;color:var(--muted);
  padding:16px;border-top:1px solid var(--border)
}
</style>
</head>

<body>

<header>
  <h1>SOA·IACORE — Dashboard Operativo V7</h1>
  <button onclick="toggleView()">Cambiar vista</button>
</header>

<section class="grid" id="exec">
  <div class="card">
    <div class="label">Estado General</div>
    <div class="metric" id="estado">—</div>
    <div class="bar"><span id="barra"></span></div>
  </div>

  <div class="card">
    <div class="label">Pipeline & Automatización</div>
    <div class="metric">100%</div>
    <p class="label">GitHub Pages · API · Cron</p>
  </div>
</section>

<section class="grid hidden" id="tech">
  <div class="card">
    <div class="label">Timeline técnico</div>
    <div class="timeline" id="timeline">Cargando…</div>
  </div>

  <div class="card">
    <div class="label">Última actualización</div>
    <p id="lastUpdate">—</p>
  </div>
</section>

<footer>
SOA·IACORE · V7 · Vista dual · Auto-refresh 30s
</footer>

<script>
let mode='exec';
function toggleView(){
  mode = mode === 'exec' ? 'tech' : 'exec';
  document.getElementById('exec').classList.toggle('hidden');
  document.getElementById('tech').classList.toggle('hidden');
}

fetch('status.json',{cache:'no-store'})
.then(r=>r.json())
.then(data=>{
  const fases=data.fases||[];
  const total=fases.reduce((a,f)=>a+(f.porcentaje||0),0);
  const avg=Math.round(total/fases.length);

  estado.textContent=avg+'%';
  barra.style.width=avg+'%';

  lastUpdate.textContent=data.ultimo_update || '—';

  const t=document.getElementById('timeline');
  t.innerHTML='';
  fases.forEach(f=>{
    const d=document.createElement('div');
    d.className='step '+(f.porcentaje===100?'done':'wip');
    d.innerHTML=`<span>${f.nombre}</span><span>${f.porcentaje}%</span>`;
    t.appendChild(d);
  });
})
.catch(e=>console.error(e));
</script>

</body>
</html>
